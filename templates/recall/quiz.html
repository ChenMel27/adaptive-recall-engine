{% extends "recall/base.html" %}
{% block title %}Quiz â€“ {{ attempt.topic.name }}{% endblock %}

{% block content %}
<div class="session-header">
    <div class="session-info">
        <h1>ğŸ“ Notes Quiz</h1>
        <p class="topic-badge">[{{ attempt.topic.standard }}] {{ attempt.topic.name }}</p>
        <p class="session-meta">Hey {{ attempt.student_name }}! &bull; Question {{ question_number }} of {{ total_questions }} &bull; <span class="streak-indicator">ğŸ”¥ You got this!</span></p>
    </div>
    <div class="session-progress">
        <div class="progress-bar">
            <div class="progress-fill" style="width: {% widthratio question_number total_questions 100 %}%"></div>
        </div>
        <form method="post" action="{% url 'recall:opt_out' attempt_id=attempt.pk %}" class="opt-out-form">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline btn-sm">I'm Done ğŸ‘‹</button>
        </form>
    </div>
</div>

{% if last_feedback and attempt.turn_count > 0 %}
<div class="feedback-card">
    <h3>ğŸ’¬ Feedback on Your Last Answer</h3>
    {% if last_feedback.is_correct %}
    <div class="feedback-section correct">
        <p>ğŸ¯ {{ last_feedback.feedback }}</p>
    </div>
    {% else %}
    <div class="feedback-section misconceptions">
        <p>{{ last_feedback.feedback }}</p>
        {% if last_feedback.correct_answer %}
        <p class="correct-answer"><strong>ğŸ’¡ Full answer:</strong> {{ last_feedback.correct_answer }}</p>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endif %}

<div class="interaction-card">
    <div class="quiz-question">
        <span class="question-badge">Question {{ question_number }} âœï¸</span>
        <h2>{{ question.question }}</h2>
        {% if question.hint %}
        <details class="hint-section">
            <summary>ğŸ’¡ Need a hint? (No shame in that!)</summary>
            <p>{{ question.hint }}</p>
        </details>
        {% endif %}
    </div>

    <form method="post" action="{% url 'recall:quiz_submit' attempt_id=attempt.pk %}" id="quiz-form">
        {% csrf_token %}
        <textarea name="answer" class="form-textarea" rows="4"
                  placeholder="Type your answer here... ğŸ’­" required autofocus></textarea>
        <div class="form-actions">
            <button type="submit" class="btn btn-primary" id="submit-btn">Submit Answer ğŸš€</button>
        </div>
    </form>

    <div class="thinking-overlay" id="thinking-overlay">
        <div class="thinking-bubble">
            <div class="thinking-dots">
                <span></span><span></span><span></span>
            </div>
            <span class="thinking-text">ğŸ§¬ BioRecall is checking your answer...</span>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.getElementById('quiz-form').addEventListener('submit', function() {
    document.getElementById('submit-btn').disabled = true;
    document.getElementById('submit-btn').textContent = 'Checking... ğŸ§¬';
    document.getElementById('thinking-overlay').classList.add('active');
});
</script>
{% endblock %}
